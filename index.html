<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <script src="MIDI.js"></script>
    <script src="MIDIUtils.js"></script>

    <script src="glass.js"></script>
</head>
<body>
<script type="text/javascript">

window.onload = function () {
    MIDI.loadPlugin({
        soundfontUrl: "./soundfont/",
        instrument: "acoustic_grand_piano",
        onprogress: function(state, progress) {
            console.log(state, progress);
        },
        onsuccess: function() {
          var delay = 0; // play one note every quarter second
          var velocity = 127; // how hard the note hits
          var tempo = 100;
          // play the note
          MIDI.setVolume(0, 127);

          var pattern1 = deserializePattern(patternsRaw[0]);
          var pattern2 = deserializePattern(patternsRaw[1]);
          var pattern3 = deserializePattern(patternsRaw[2]);
          var pattern4 = deserializePattern(patternsRaw[3]);

          var left = new Line();
          var right = new Line();

          for (var i = 0; i < 3; i++) {
            left.addPattern(pattern4, "A", "m", -1);
            right.addPattern(pattern1, "A", "m", 1);
            left.addPattern(pattern2, "A", "m", -1);
            right.addPattern(pattern1, "A", "m", 1);
          }

          for (var i = 0; i < 2; i++) {
            left.addPattern(pattern1, "F", "m", 0);
            left.addPattern(pattern1, "C", "m", 0);
            left.addPattern(pattern1, "Ab", "M", 0);
            left.addPattern(pattern1, "C", "m", 0);
          }

          right.addPattern(pattern2, "F", "m", 0);
          right.addPattern(pattern2, "C", "m", 0);
          right.addPattern(pattern2, "Ab", "M", 0);
          right.addPattern(pattern2, "C", "m", 0);
          right.addPattern(pattern3, "F", "m", 0);
          right.addPattern(pattern2, "C", "m", 0);
          right.addPattern(pattern2, "Ab", "M", 0);
          right.addPattern(pattern2, "C", "m", 0);

          left.play(tempo);
          right.play(tempo);
        }
    });
};

</script>
</body>
</html>
